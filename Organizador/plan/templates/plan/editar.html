{% extends 'plan/base.html' %}
{% load static %}

{% block extra_head %}
<title>Editar plan</title>
<link rel="stylesheet" href="{% static 'plan/css/form.css' %}">
{% endblock extra_head %}

{% block content %}
<div class="form-container">
  <h2>Editar plan</h2>

  <form method="POST">
    {% csrf_token %}
    <div class="form-group">
      <label for="title">Título:</label>
      {{ form.title }}
    </div>

    <div class="form-group">
      <label for="content">Contenido:</label>
      {{ form.content }}
    </div>

    <div class="form-group">
      <label for="tipo">Tipo:</label>
      {{ form.tipo }}
    </div>

    <div class="form-group checkbox-group">
      <label for="realizado">¿Ya cumpliste este menu?</label>
      {{ form.realizado }}
    </div>

    <h4>Comidas</h4>
    {{ formset.management_form }}
    <div id="formset-container">
      {% for f in formset %}
      <div class="form-row">
        {% for hidden in f.hidden_fields %}
        {{ hidden }}
        {% endfor %}
        <div class="form-group">
          <label>Comida:</label>
          {{ f.comida }}
        </div>
        <div class="form-group">
          <label>Cantidad:</label>
          {{ f.cantidad }}
        </div>
        {% if formset.can_delete %}
        <div class="form-group">
          <label>Eliminar:</label>
          {{ f.DELETE }}
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <button type="button" id="add-form" class="btn btn-secondary">Agregar comida</button>
    <button type="submit" class="btn btn-success">Guardar cambios</button>
    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
      <a href="{% url 'index' %}" class="btn-cancelar">Cancelar</a>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const addButton = document.getElementById('add-form');
    const formContainer = document.getElementById('formset-container');
    const totalForms = document.querySelector('#id_form-TOTAL_FORMS');

    addButton.addEventListener('click', function () {
      const formCount = parseInt(totalForms.value);
      const newForm = formContainer.children[0].cloneNode(true);

      newForm.querySelectorAll('input, select').forEach(input => {
        input.name = input.name.replace(`form-0`, `form-${formCount}`);
        input.id = input.id.replace(`id_form-0`, `id_form-${formCount}`);
        if (input.type !== 'hidden') input.value = '';
      });

      formContainer.appendChild(newForm);
      totalForms.value = formCount + 1;
    });
  });
</script>
{% endblock content %}